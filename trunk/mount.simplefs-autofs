#!/bin/sh

set -e

if [ `basename $0` = "umount.simplefs-autofs" ]; then
	unmount=1
	mountpath=$1
else
	mountpath=$2
fi

dn=`dirname $mountpath`
bn=`basename $mountpath`
mountpath_real="$dn/.$bn"

if [ x$unmount = x1 ]; then
	umount -i "$mountpath"
	exec umount "$mountpath_real"
fi
mount -o "$4" "$mountpath_real"
exec mount --move "$mountpath_real" -o helper=simplefs-autofs "$mountpath"
